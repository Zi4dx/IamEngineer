<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الجدول الدراسي - كلية الهندسة</title>
    
    <!-- إضافة أيقونة للموقع (Favicon) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%232563eb%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M22 10v6M2 10l10-5 10 5-10 5z%22/><path d=%22M6 12v5c3 3 9 3 12 0v-5%22/></svg>">

    <!-- خط IBM Plex Sans Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['IBM Plex Sans Arabic', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#151e2e',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* إخفاء شريط التمرير لكن السماح بالتمرير */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
        }

        /* تحسينات للحركات */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-gradient-to-l from-blue-900 to-blue-700 text-white pb-20 pt-8 px-4 relative overflow-hidden rounded-b-[2.5rem] shadow-xl shrink-0">
        
        <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/3 blur-3xl z-0"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-amber-500/10 rounded-full translate-y-1/3 -translate-x-1/3 blur-3xl z-0"></div>
        
        <div class="container mx-auto relative z-10">
            <div class="flex flex-row justify-between items-center gap-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-md shadow-inner border border-white/20">
                        <i data-lucide="graduation-cap" class="text-amber-400 w-6 h-6"></i>
                    </div>
                    <div>
                        <h1 class="text-lg md:text-2xl font-bold leading-tight">كلية الهندسة</h1>
                        <p class="text-blue-200 text-xs md:text-sm">الجامعة الأسمرية</p>
                    </div>
                </div>
                <button id="themeToggle" class="p-2.5 bg-white/10 hover:bg-white/20 rounded-full backdrop-blur-md transition-all border border-white/10 active:scale-95">
                    <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
                    <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                </button>
            </div>
            
            <!-- تم توسيط النص هنا -->
            <div class="w-full text-center px-1">
                <h2 class="text-3xl md:text-5xl font-bold mb-2 leading-tight">الجدول الدراسي <span class="text-amber-400 block text-2xl md:text-4xl mt-1 font-medium">خريف 2026</span></h2>
                <p class="text-blue-100/80 text-xs md:text-sm flex items-center justify-center gap-1 mt-3">
                    <i data-lucide="clock" class="w-3 h-3"></i>
                    آخر تحديث: 10 - 12 - 2025
                </p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 -mt-12 relative z-20 pb-20 flex-grow">
        
        <!-- Stats Grid -->
        <div id="statsGrid" class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            <!-- Stats will be injected here -->
        </div>

        <!-- Controls -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-3 mb-6 sticky top-2 z-30 border border-slate-100 dark:border-slate-700 backdrop-blur-md bg-white/90 dark:bg-slate-800/90 supports-[backdrop-filter]:bg-white/60">
            <div class="flex flex-col gap-3">
                <!-- Days Tabs -->
                <div class="w-full overflow-x-auto pb-1 scrollbar-hide -mx-1 px-1">
                    <div id="daysTabs" class="flex gap-2 min-w-max">
                        <!-- Tabs generated by JS -->
                    </div>
                </div>

                <!-- Search & View Toggle -->
                <div class="flex gap-2">
                    <div class="relative flex-1">
                        <i data-lucide="search" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="ابحث..."
                            class="w-full pr-10 pl-4 py-2.5 text-sm bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-white transition-all"
                        />
                    </div>
                    <button id="viewToggle" class="p-2.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors border border-slate-200 dark:border-slate-600">
                        <i data-lucide="layout-grid" class="w-5 h-5 block" id="gridIcon"></i>
                        <i data-lucide="list" class="w-5 h-5 hidden" id="listIcon"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Schedule Grid -->
        <div id="scheduleContainer" class="space-y-6 min-h-[300px]">
            <!-- Content injected by JS -->
        </div>

    </main>

    <!-- Modal -->
    <div id="classModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="bg-blue-600 p-6 text-white relative">
                <button id="closeModal" class="absolute top-4 left-4 p-1 rounded-full hover:bg-white/20 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <h2 id="modalSubject" class="text-2xl font-bold mb-1"></h2>
                <p class="text-blue-100 flex items-center gap-2">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span id="modalInstructor"></span>
                </p>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                    <div class="bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full text-blue-600 dark:text-blue-400">
                        <i data-lucide="clock" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500 dark:text-slate-400">الوقت</p>
                        <p id="modalTime" class="font-semibold text-slate-800 dark:text-slate-100"></p>
                    </div>
                </div>
                <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                    <div class="bg-amber-100 dark:bg-amber-900/30 p-2 rounded-full text-amber-600 dark:text-amber-400">
                        <i data-lucide="map-pin" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500 dark:text-slate-400">القاعة</p>
                        <p id="modalRoom" class="font-semibold text-slate-800 dark:text-slate-100"></p>
                    </div>
                </div>
                <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                    <div class="bg-emerald-100 dark:bg-emerald-900/30 p-2 rounded-full text-emerald-600 dark:text-emerald-400">
                        <i data-lucide="calendar" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500 dark:text-slate-400">اليوم</p>
                        <p id="modalDay" class="font-semibold text-slate-800 dark:text-slate-100"></p>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-700 flex justify-end">
                <button id="closeModalBtn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium w-full md:w-auto">
                    إغلاق
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 mt-auto border-t border-slate-800 shrink-0">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2 font-medium text-slate-300">كلية الهندسة - الجامعة الأسمرية الإسلامية</p>
            <p class="text-xs opacity-60">جميع الحقوق محفوظة للطالب زياد أبولائطة © 2025</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- البيانات الدراسية ---
        const scheduleData = {
            'السبت': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'رياضة 1', instructor: 'د. علي فرحات', room: '202' },
                    { subject: 'ديناميكا حرارية 1', instructor: 'أ. فرج الكيلاني', room: '203' },
                    { subject: 'تصميم معماري 2', instructor: 'د. يوسف طاهر', room: '206' },
                    { subject: 'كيمياء', instructor: 'أ. فاطمة ابوتبينة', room: '209' },
                    { subject: 'رياضة 3', instructor: 'د. عبد الناصر القعود', room: '306' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'تحكم آلي ميكانيكي', instructor: 'عبد السلام القهواجي', room: '301' },
                    { subject: 'تصميم خرسانة 3', instructor: 'محمد شكشك', room: '303' },
                    { subject: 'إلكترونيات تماثلية', instructor: 'د. سالم الهمالي', room: '308' },
                    { subject: 'نظرية إنشاءات 2', instructor: 'أ. أحمد العيان', room: '309' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'ميكانيكا هندسية 1', instructor: 'أ. أسالم بلعيد', room: '202' },
                    { subject: 'ميكانيكا هندسية 1', instructor: 'أ. أيمن الكوت', room: '203' },
                    { subject: 'نظريات ومبادئ التخطيط', instructor: 'د. قراض', room: '206' },
                    { subject: 'لغة إنجليزية 2', instructor: 'د. محمد البحبوح', room: '208' },
                    { subject: 'هندسة وصفية', instructor: 'أ. سالم خوجة', room: '209' },
                    { subject: 'رصف طرق', instructor: 'أ. طارق شميلة', room: '301' },
                    { subject: 'نظريات عمارة', instructor: 'د. يوسف طاهر', room: '303' },
                    { subject: 'فيزياء 2', instructor: 'أ. محمد ابوسنينة', room: '304' },
                    { subject: 'إلكترونيات رقمية', instructor: 'د. سالم الهمالي', room: '308' },
                    { subject: 'تصميم خرسانة 1', instructor: 'أ. أحمد العيان', room: '309' },
                    { subject: 'أنظمة تحكم 1', instructor: 'أ. أحمد العاتي', room: '310' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'نظرية آلات 1', instructor: 'أ. أسالم بلعيد', room: '202' },
                    { subject: 'إنشاء معماري 2', instructor: 'أ. علي اقزيط', room: '203' },
                    { subject: 'رسم معماري', instructor: 'علي هويدي', room: '206' },
                    { subject: 'هندسة بيئة 1', instructor: 'أ. سالم خوجة', room: '209' },
                    { subject: 'مقاومة مواد 1', instructor: 'أ. طارق شميلة', room: '301' },
                    { subject: 'انتقال الحرارة', instructor: 'أ. نور الدين كريم', room: '304' },
                    { subject: 'أنظمة تحكم متعددة المتغيرات', instructor: 'أ. أحمد العاتي', room: '310' },
                ],
                '4:00 م - 6:00 م': []
            },
            'الأحد': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'تاريخ العمارة', instructor: 'د. فضل المولي', room: '303' },
                    { subject: 'ميكانيكا تربة 1', instructor: 'أ. عبدالله غويلة', room: '304' },
                    { subject: 'نظم تحكم مثلى', instructor: 'أ. محمد الشريف', room: '308' },
                    { subject: 'إشارات ونظم', instructor: 'أ. محمد الشريف', room: '309' },
                    { subject: 'فيزياء 1', instructor: 'أ. مريم حمير', room: '202' },
                    { subject: 'أحكام الفقه الإسلامي', instructor: 'أ. عمر ابو حجر', room: '203' },
                    { subject: 'ميكانيكا هندسية 1', instructor: 'أ. رمضان البتي', room: '301' },
                    { subject: 'كيمياء فيزيائية 1', instructor: 'أ. نور الدين كريم', room: '301' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'تشييد مباني', instructor: 'محمد شكشك', room: '303' },
                    { subject: 'تأهيل منشآت', instructor: 'أ. عبدالله غويلة', room: '304' },
                    { subject: 'لغة عربية', instructor: 'د. محمود ابوحجر', room: '307' },
                    { subject: 'معمل دوائر 1', instructor: 'د. فتحي البكوش', room: '305' },
                    { subject: 'تصميم معماري 3', instructor: 'د. قراض', room: '206' },
                    { subject: 'رياضة 1', instructor: 'د. علي فرحات', room: '208' },
                    { subject: 'كيمياء', instructor: 'أ. فاطمة ابوتبينة', room: '209' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'هندسة أساسات', instructor: 'محمد شكشك', room: '303' },
                    { subject: 'مواد بناء', instructor: 'علي هويدي', room: '307' },
                    { subject: 'تصميم أنظمة تحكم', instructor: 'أ. سالم إعبيد', room: '205' },
                    { subject: 'ديناميكا حرارية 2', instructor: 'د. المهدي الحويج', room: '305' },
                    { subject: 'رسم هندسي', instructor: 'د. مصطفى أحمد شكشك', room: '206' },
                    { subject: 'إدارة المشاريع', instructor: 'أ. احمد شكشك', room: '207' },
                    { subject: 'إحصاء', instructor: 'د. علي شكشك', room: '209' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'لغة إنجليزية 1', instructor: 'د. محمد البحبوح', room: '303' },
                    { subject: 'ثقافة وطنية', instructor: 'د. مصطفى الجبو', room: '307' },
                    { subject: 'تصميم معماري 4', instructor: 'د. يوسف طاهر', room: '310' },
                    { subject: 'انتقال مادة 2', instructor: 'د. المهدي الحويج', room: '305' },
                    { subject: 'نظرية إنشاءات 1', instructor: 'أ. أيمن الكوت', room: '203' },
                    { subject: 'كميات ومواصفات', instructor: 'أ. أحمد العيان', room: '208' },
                    { subject: 'معمل خرسانة', instructor: 'محمد شكشك', room: '209' },
                ],
                '4:00 م - 6:00 م': []
            },
            'الإثنين': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'مقدمة هندسة كيميائية', instructor: 'خالد الجفايري', room: '302' },
                    { subject: 'كتابة تقارير فنية', instructor: 'أ. محمد ابوسنينة', room: '303' },
                    { subject: 'العقيدة والفكر الإسلامي', instructor: 'نوري الطرلي', room: '304' },
                    { subject: 'دوائر 1', instructor: 'أ. سالم عوينات', room: '310' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'مشروع تخرج', instructor: '-', room: '303' },
                    { subject: 'علم الأحياء العام', instructor: 'عبد الطيف الزروقي', room: '306' },
                    { subject: 'بحوث العمليات', instructor: 'د. علي شكشك', room: '310' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'تقنية ورش', instructor: 'أ. مصطفي صوفيا', room: '302' },
                    { subject: 'هندسة إنتاج 4', instructor: 'أ. ميلاد التونسي', room: '303' },
                    { subject: 'هيدرولوجيا', instructor: 'أ. سالم خوجة', room: '306' },
                    { subject: 'تحكم آلي كيميائية', instructor: 'أ. مراجع هندر', room: '309' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'هندسة إنتاج 2', instructor: 'أ. ميلاد التونسي', room: '303' },
                    { subject: 'ميكانيكا الموائع', instructor: 'أ. فرج الكيلاني', room: '306' },
                    { subject: 'هندسة تآكل', instructor: 'أ. مراجع هندر', room: '309' },
                ],
                '4:00 م - 6:00 م': []
            },
            'الثلاثاء': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'التصميم الهندسي للطرق', instructor: 'أ. محمد بن حليم', room: 'المسرح' },
                    { subject: 'كيمياء', instructor: 'أ. صلاح المريمي', room: '202' },
                    { subject: 'أحكام الفقه الإسلامي', instructor: 'أ. عمر ابو حجر', room: '203' },
                    { subject: 'ميكانيكا تربة 2', instructor: 'أ. عبدالله غويلة', room: '208' },
                    { subject: 'تأهيل منشآت', instructor: 'أ. عبدالله غويلة', room: '301' },
                    { subject: 'مصفات نفط', instructor: 'أ. محمد سليم فرحات', room: '302' },
                    { subject: 'فيزياء 2', instructor: 'أ. محمد ابوسنينة', room: '304' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'تصميم معماري 3', instructor: 'د. قراض', room: '305' },
                    { subject: 'مساحة 2', instructor: 'أ. محمد بن حليم', room: 'المسرح' },
                    { subject: 'تصميم خرسانة 2', instructor: 'أ. أحمد العيان', room: '202' },
                    { subject: 'فيزياء معمل', instructor: 'د. مصطفى ديهوم', room: '208' },
                    { subject: 'رياضة 4', instructor: 'د. عبد الناصر القعود', room: '301' },
                    { subject: 'الذكاء الاصطناعي', instructor: 'سالم عبيد', room: '302' },
                    { subject: 'تحكم آلي ميكانيكي', instructor: 'عبد السلام القهواجي', room: '303' },
                    { subject: 'رياضة 1', instructor: 'د. عبد الناصر القعود', room: '304' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'برمجة حاسوب', instructor: 'أ. سالم إعبيد', room: '205' },
                    { subject: 'لغة عربية', instructor: 'د. محمود ابوحجر', room: '203' },
                    { subject: 'تخطيط عمراني', instructor: 'د. قراض', room: '206' },
                    { subject: 'رسومات تنفيذية 1', instructor: 'د. فضل المولي', room: '207' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'اقتصاد هندسي', instructor: 'أ. مصطفي صوفيا', room: '208' },
                ],
                '4:00 م - 6:00 م': []
            },
            'الأربعاء': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'هندسة بيئة 1', instructor: 'أ. سالم خوجة', room: '308' },
                    { subject: 'أساسيات دوائر', instructor: 'د. فتحي البكوش', room: '309' },
                    { subject: 'تشييد مباني', instructor: 'محمد شكشك', room: '310' },
                    { subject: 'التحويل الكهروميكانيكي للطاقة', instructor: 'أ. محمد الشريف', room: '205' },
                    { subject: 'لغة إنجليزية 1', instructor: 'د. محمد البحبوح', room: '202' },
                    { subject: 'ميكانيكا هندسية 1', instructor: 'أ. رمضان البتي', room: '203' },
                    { subject: 'عمارة محلية', instructor: 'د. يوسف طاهر', room: '206' },
                    { subject: 'هندسة تآكل', instructor: 'أ. مراجع هندر', room: '209' },
                    { subject: 'ثقافة وطنية', instructor: 'د. مصطفى الجبو', room: '301' },
                    { subject: 'أساسيات دوائر', instructor: 'د. فتحي البكوش', room: '307' },
                    { subject: 'تصميم معماري 2', instructor: 'أ. محمد بن حليم', room: '205' },
                    { subject: 'ميكانيكا الموائع', instructor: 'أ. فرج الكيلاني', room: '305' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'مقدمة هندسة كيميائية', instructor: 'فرج الكيلاني', room: '306' },
                    { subject: 'كيمياء فيزيائية 2', instructor: 'أ. فرج الكيلاني', room: '307' },
                    { subject: 'أنظمة رقمية', instructor: 'د. فتحي البكوش', room: '309' },
                    { subject: 'هندسة أساسات', instructor: 'محمد شكشك', room: '310' },
                    { subject: 'دوائر 2', instructor: 'أ. محمد الشريف', room: '205' },
                    { subject: 'فيزياء 1', instructor: 'أ. مريم حمير', room: '202' },
                    { subject: 'فيزياء 1', instructor: 'أ. مريم حمير', room: '203' },
                    { subject: 'كميات ومواصفات', instructor: 'أ. أحمد العيان', room: '207' },
                    { subject: 'ميكانيكا هندسية 1', instructor: 'أ. أسالم بلعيد', room: '208' },
                    { subject: 'نظرية إنشاءات 1', instructor: 'أ. أيمن الكوت', room: '303' },
                    { subject: 'شبكة أنابيب', instructor: 'أ. عطية بن نجي', room: '304' },
                    { subject: 'تخطيط إدارة العمران', instructor: 'مصطفي حكومه', room: '306' },
                    { subject: 'طرق تحليلات عددية', instructor: 'د. سعد الغويل', room: '307' },
                    { subject: 'ميكانيكا تربة 2', instructor: 'أ. عبدالله غويلة', room: '310' },
                    { subject: 'هندسة تفاعلات 2', instructor: 'مصطفى الهليب', room: '305' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'تصميم أجزاء الآلات', instructor: 'د. معمر حميد', room: '307' },
                    { subject: 'تصميم أنظمة تحكم', instructor: 'أ. سالم إعبيد', room: '205' },
                    { subject: 'صناعات بتروكيميائية', instructor: 'خالد الجفايري', room: '202' },
                    { subject: 'تصميم معماري 1', instructor: 'د. يوسف طاهر', room: '206' },
                    { subject: 'إدارة المشاريع', instructor: 'أ. احمد شكشك', room: '207' },
                    { subject: 'نظرية آلات 1', instructor: 'أ. أسالم بلعيد', room: '208' },
                    { subject: 'كيمياء عضوية', instructor: 'أ. نور الدين كريم', room: '209' },
                    { subject: 'إدارة الموارد', instructor: 'د. علي شكشك', room: '301' },
                    { subject: 'تصميم مصانع', instructor: 'أ. خالد إعبيد', room: '304' },
                    { subject: 'هندسة نقل ومرور', instructor: 'أ. طارق شميلة', room: '306' },
                    { subject: 'قياسات كهربية وإلكترونية', instructor: 'سالم عوينات', room: '307' },
                    { subject: 'دوائر 1', instructor: 'أ. سالم عوينات', room: '308' },
                    { subject: 'معالجات دقيقة 1', instructor: 'د. فتحي البكوش', room: '309' },
                    { subject: 'رسم مدني', instructor: 'د. فضل المولي', room: '305' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'ديناميكا حرارية 1', instructor: 'أ. فرج الكيلاني', room: '306' },
                    { subject: 'معمل إلكترونيات', instructor: 'د. سالم الهمالي', room: '205' },
                    { subject: 'إنشاء معماري 4', instructor: 'أ. علي اقزيط', room: '305' },
                    { subject: 'طرق التحليل الآلي', instructor: 'خالد الجفايري', room: '202' },
                    { subject: 'رسم هندسي', instructor: 'د. مصطفى أحمد شكشك', room: '207' },
                    { subject: 'إحصاء', instructor: 'د. علي شكشك', room: '208' },
                    { subject: 'ميكانيكا هندسية 2', instructor: 'د. احمد العيان', room: '209' },
                    { subject: 'ديناميكا حرارية 2', instructor: 'د. المهدي الحويج', room: '301' },
                    { subject: 'انتقال مادة 2', instructor: 'د. المهدي الحويج', room: '302' },
                    { subject: 'تقنية ورش', instructor: 'أ. مصطفي صوفيا', room: '303' },
                ],
                '4:00 م - 6:00 م': []
            },
            'الخميس': {
                '8:00 ص - 10:00 ص': [
                    { subject: 'رياضة 1', instructor: 'د. علي فرحات', room: '203' },
                    { subject: 'تصميم داخلي 1', instructor: 'عيسي صوان', room: '206' },
                    { subject: 'كيمياء معمل', instructor: 'أ. نور الدين كريم', room: '301' },
                    { subject: 'مدخل إلى القرآن', instructor: 'عبد الرحمن خليفة', room: '302' },
                    { subject: 'كيمياء عضوية 2', instructor: 'أ. خالد الجفايري', room: '306' },
                    { subject: 'تصميم خرسانة 3', instructor: 'محمد شكشك', room: '308' },
                    { subject: 'هيدرولوجيا', instructor: 'أ. سالم خوجة', room: '310' },
                    { subject: 'تصميم معماري 5', instructor: 'د. فضل المولي', room: '305' },
                    { subject: 'أنظمة تحكم حاسوبية', instructor: 'د. سعد الغويل', room: 'المسرح' },
                ],
                '10:00 ص - 12:00 م': [
                    { subject: 'أنظمة رقمية', instructor: 'د. فتحي البكوش', room: '207' },
                    { subject: 'إحصاء', instructor: 'د. علي شكشك', room: '208' },
                    { subject: 'لغة إنجليزية 1', instructor: 'د. محمد البحبوح', room: '209' },
                    { subject: 'علم الأحياء العام', instructor: 'عبد الطيف الزروقي', room: '306' },
                    { subject: 'خواص مواد', instructor: 'أ. طارق شميلة', room: '308' },
                    { subject: 'مقاومة مواد 1', instructor: 'أ. طارق شميلة', room: '309' },
                    { subject: 'ميكانيكا موائع 2', instructor: 'أ. سالم خوجة', room: '310' },
                ],
                '12:00 م - 2:00 م': [
                    { subject: 'رياضة 2', instructor: 'أ. سالم عوينات', room: '202' },
                    { subject: 'تصميم معماري 4', instructor: 'د. يوسف طاهر', room: '206' },
                    { subject: 'أنظمة تحكم 1', instructor: 'أ. أحمد العاتي', room: '208' },
                    { subject: 'إنتقال الحرارة', instructor: 'أ. نور الدين كريم', room: '209' },
                    { subject: 'فيزياء 2', instructor: 'د. مصطفى ديهوم', room: '301' },
                    { subject: 'العقيدة والفكر الإسلامي', instructor: 'نوري الطرلي', room: '302' },
                    { subject: 'مبادئ هندسة كهربائية', instructor: 'سالم الهمالي', room: '303' },
                    { subject: 'ميكانيكا الموائع', instructor: 'أ. فرج الكيلاني', room: '304' },
                    { subject: 'أنظمة التحكم اللاخطية', instructor: 'د. سعد الغويل', room: '308' },
                    { subject: 'بحوث العمليات', instructor: 'د. علي شكشك', room: '310' },
                    { subject: 'تطبيقات حاسوب', instructor: 'عيسي صوان', room: '205' },
                    { subject: 'رسم حر', instructor: 'أ. محمد بن حليم', room: '305' },
                ],
                '2:00 م - 4:00 م': [
                    { subject: 'ميكانيكا موائع 1', instructor: 'د. احمد العيان', room: '202' },
                    { subject: 'ميكانيكا هندسية 2', instructor: 'د. احمد العيان', room: '203' },
                    { subject: 'هندسة إنتاج 4', instructor: 'أ. ميلاد التونسي', room: '207' },
                    { subject: 'أنظمة تحكم متعددة المتغيرات', instructor: 'أ. أحمد العاتي', room: '208' },
                    { subject: 'دوائر 2', instructor: 'أ. محمد الشريف', room: '306' },
                ],
                '4:00 م - 6:00 م': []
            }
        };

        const days = ['السبت', 'الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس'];
        
        // State
        let state = {
            activeDay: 'السبت',
            searchTerm: '',
            isListView: false,
            darkMode: false
        };

        // --- تهيئة التطبيق ---
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            lucide.createIcons();
            setInterval(renderSchedule, 60000); // تحديث كل دقيقة للبث المباشر
        });

        function initApp() {
            // استرجاع الوضع المظلم من localStorage
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                state.darkMode = true;
                document.documentElement.classList.add('dark');
            }

            // تحديد اليوم الحالي
            const today = getCurrentDayArabic();
            if (days.includes(today)) {
                state.activeDay = today;
            }

            // Render components
            renderStats();
            renderDays();
            renderSchedule();

            // Event Listeners
            document.getElementById('searchInput').addEventListener('input', (e) => {
                state.searchTerm = e.target.value;
                renderSchedule();
            });

            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('viewToggle').addEventListener('click', toggleView);
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            
            // Close modal on click outside
            document.getElementById('classModal').addEventListener('click', (e) => {
                if(e.target.id === 'classModal') closeModal();
            });
        }

        // --- Logic Helper Functions ---

        function getCurrentDayArabic() {
            const dayIndex = new Date().getDay();
            const dayMap = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            return dayMap[dayIndex];
        }

        function isTimeCurrent(timeSlot) {
            const today = getCurrentDayArabic();
            // يجب أن يكون اليوم الحالي هو نفس اليوم المحدد في التبويبات
            if (today !== state.activeDay) return false;

            const times = timeSlot.split('-').map(t => t.trim());
            if (times.length !== 2) return false;

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const startMinutes = parseTime(times[0]);
            const endMinutes = parseTime(times[1]);

            return currentMinutes >= startMinutes && currentMinutes < endMinutes;
        }

        function parseTime(timeStr) {
            // إزالة أي رموز غير الأرقام والنقطتين والحروف العربية (ص/م)
            const cleanStr = timeStr.replace(/[^\d:صم]/g, '');
            const match = cleanStr.match(/(\d+):(\d+)(ص|م)?/);
            
            if (!match) return 0;
            
            let [_, h, m, period] = match;
            let hours = parseInt(h);
            let minutes = parseInt(m);
            
            if (period === 'م') {
                if (hours < 12) hours += 12;
            } else if (period === 'ص') {
                if (hours === 12) hours = 0;
            } else {
                // تخمين ذكي في حال غياب ص/م
                // الدوام عادة من 8 صباحاً. الأرقام 1,2,3,4,5,6 تعني مساءً (13-18)
                if (hours < 7) hours += 12; 
            }
            
            return hours * 60 + minutes;
        }

        function toggleTheme() {
            state.darkMode = !state.darkMode;
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', state.darkMode ? 'dark' : 'light');
        }

        function toggleView() {
            state.isListView = !state.isListView;
            document.getElementById('gridIcon').classList.toggle('hidden');
            document.getElementById('listIcon').classList.toggle('hidden');
            renderSchedule();
        }

        // --- Render Functions ---

        function renderStats() {
            const subjects = new Set();
            const instructors = new Set();
            const rooms = new Set();
            let hours = 0;

            Object.values(scheduleData).forEach(day => {
                Object.values(day).forEach(slot => {
                    slot.forEach(item => {
                        subjects.add(item.subject);
                        if (item.instructor && item.instructor !== '-') instructors.add(item.instructor);
                        if (item.room) rooms.add(item.room);
                        hours += 2;
                    });
                });
            });

            const stats = [
                { label: 'مادة', value: subjects.size, icon: 'book-open', color: 'bg-blue-500' },
                { label: 'أستاذ', value: instructors.size, icon: 'user', color: 'bg-emerald-500' },
                { label: 'قاعة', value: rooms.size, icon: 'map-pin', color: 'bg-amber-500' },
                { label: 'ساعة/أسبوع', value: hours, icon: 'clock', color: 'bg-purple-500' }
            ];

            const container = document.getElementById('statsGrid');
            container.innerHTML = stats.map(stat => `
                <div class="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col md:flex-row items-center md:items-start text-center md:text-right gap-3 md:gap-4 min-w-[140px] md:min-w-0">
                    <div class="p-3 rounded-xl ${stat.color} text-white">
                        <i data-lucide="${stat.icon}" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-slate-800 dark:text-white">${stat.value}</p>
                        <p class="text-xs text-slate-500 dark:text-slate-400">${stat.label}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderDays() {
            const container = document.getElementById('daysTabs');
            container.innerHTML = days.map(day => `
                <button
                    onclick="changeDay('${day}')"
                    class="px-4 py-2 rounded-lg text-sm font-bold transition-all duration-200 whitespace-nowrap border ${
                        state.activeDay === day 
                        ? 'bg-blue-600 text-white border-blue-600 shadow-md shadow-blue-500/20' 
                        : 'bg-slate-50 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-600'
                    }"
                >
                    ${day}
                </button>
            `).join('');
        }

        window.changeDay = function(day) {
            state.activeDay = day;
            renderDays();
            renderSchedule();
        }

        function renderSchedule() {
            const container = document.getElementById('scheduleContainer');
            const dayData = scheduleData[state.activeDay];
            let html = '';
            
            const term = state.searchTerm.toLowerCase();
            let hasData = false;

            if (dayData) {
                Object.entries(dayData).forEach(([time, items]) => {
                    const filteredItems = items.filter(item => 
                        item.subject.toLowerCase().includes(term) ||
                        (item.instructor && item.instructor.toLowerCase().includes(term)) ||
                        item.room.toLowerCase().includes(term)
                    );

                    if (filteredItems.length > 0) {
                        hasData = true;
                        const isSlotActive = isTimeCurrent(time);
                        
                        html += `
                        <div class="relative fade-in">
                            <div class="flex items-center gap-3 mb-3 sticky top-0 z-0">
                                <div class="px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 border transition-colors duration-500 ${
                                    isSlotActive 
                                    ? 'bg-red-100 text-red-700 border-red-300 shadow-sm' 
                                    : 'bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-100 dark:border-blue-800'
                                }">
                                    <i data-lucide="${isSlotActive ? 'radio' : 'clock'}" class="w-3 h-3 ${isSlotActive ? 'animate-pulse text-red-600' : ''}"></i>
                                    ${time}
                                    ${isSlotActive ? '<span class="mr-1 text-[10px] bg-red-600 text-white px-1.5 py-0.5 rounded-sm animate-pulse">مباشر الآن</span>' : ''}
                                </div>
                                <div class="h-px flex-1 transition-colors duration-500 ${isSlotActive ? 'bg-red-300' : 'bg-slate-200 dark:bg-slate-700'}"></div>
                            </div>
                            
                            <div class="grid ${state.isListView ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4'} gap-3">
                                ${filteredItems.map(item => createCardHTML(item, time, isSlotActive)).join('')}
                            </div>
                        </div>
                        `;
                    }
                });
            }

            if (!hasData) {
                html = `
                <div class="text-center py-16 bg-white dark:bg-slate-800 rounded-3xl border border-dashed border-slate-200 dark:border-slate-700 mx-4 fade-in">
                    <div class="bg-slate-50 dark:bg-slate-700/50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i data-lucide="search" class="w-8 h-8 text-slate-400"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-200">لا توجد محاضرات</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400 px-4">لم يتم العثور على أي محاضرات في هذا اليوم أو البحث.</p>
                </div>
                `;
            }

            container.innerHTML = html;
            lucide.createIcons();
        }

        function createCardHTML(item, time, isSlotActive) {
            // Encode item data safely for onclick
            const itemString = encodeURIComponent(JSON.stringify({...item, timeSlot: time, day: state.activeDay}));
            
            return `
            <div 
                onclick="openModal('${itemString}')"
                class="group rounded-xl p-4 border shadow-sm hover:shadow-lg transition-all duration-300 cursor-pointer relative overflow-hidden ${
                    isSlotActive 
                    ? 'bg-gradient-to-br from-white to-red-50 dark:from-slate-800 dark:to-red-900/20 border-red-200 dark:border-red-800 ring-1 ring-red-100 dark:ring-red-900/50' 
                    : 'bg-white dark:bg-slate-800 border-slate-100 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700'
                }"
            >
                <div class="absolute top-0 right-0 w-1 h-full transform origin-top scale-y-0 group-hover:scale-y-100 transition-transform duration-300 ${
                    isSlotActive ? 'bg-red-500' : 'bg-blue-500'
                }"></div>
                
                <div class="flex justify-between items-start gap-2">
                    <h3 class="font-bold text-base mb-2 line-clamp-2 leading-snug transition-colors ${
                        isSlotActive ? 'text-red-900 dark:text-red-100' : 'text-slate-800 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400'
                    }">
                        ${item.subject}
                    </h3>
                </div>
                
                <div class="space-y-1.5">
                    <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400 text-xs">
                        <i data-lucide="user" class="w-3.5 h-3.5 ${isSlotActive ? "text-red-400" : "text-blue-500/70"}"></i>
                        <span class="truncate">${item.instructor || 'غير محدد'}</span>
                    </div>
                    <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400 text-xs">
                        <i data-lucide="map-pin" class="w-3.5 h-3.5 ${isSlotActive ? "text-red-400" : "text-amber-500/70"}"></i>
                        <span class="font-medium ${isSlotActive ? 'text-red-700 dark:text-red-300' : 'text-slate-700 dark:text-slate-300'}">قاعة ${item.room}</span>
                    </div>
                </div>
            </div>
            `;
        }

        // --- Modal Logic ---
        const modal = document.getElementById('classModal');
        const modalContent = document.getElementById('modalContent');

        window.openModal = function(itemString) {
            const data = JSON.parse(decodeURIComponent(itemString));
            
            document.getElementById('modalSubject').textContent = data.subject;
            document.getElementById('modalInstructor').textContent = data.instructor || 'غير محدد';
            document.getElementById('modalTime').textContent = data.timeSlot;
            document.getElementById('modalRoom').textContent = `قاعة ${data.room}`;
            document.getElementById('modalDay').textContent = data.day;

            modal.classList.remove('hidden');
            // Trigger reflow for transition
            void modal.offsetWidth; 
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
        }

        window.closeModal = function() {
            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

    </script>
</body>
</html>
